{"version":3,"sources":["drawImg.js"],"names":["canvas","document","querySelector","context","getContext","W","width","H","height","dragging","imageData","mousedown","selectRec","bg","Image","src","onload","drawImage","scale","resetButton","clearRect","checked","windowToCanvas","x","y","canvasRectangle","getBoundingClientRect","left","top","captureRubberbandPixels","getImageData","restoreRubberbandPixels","putImageData","drawRubberband","strokeRect","lineWidth","updateRubberband","rubberbandStart","setRubberbandRectangle","Math","min","abs","rubberbandStretch","rubberbandEnd","strokeStyle","console","log","data","length","addEventListener","e","loc","clientX","clientY","preventDefault"],"mappings":"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","file":"drawImg.js","sourcesContent":["let canvas = document.querySelector('#canvas'),\r\n    context = canvas.getContext('2d'),\r\n    W = canvas.width,\r\n    H = canvas.height,\r\n    dragging = false,\r\n    imageData = null,\r\n    mousedown = {},\r\n    selectRec = {},\r\n    bg = new Image();\r\nbg.src = 'img/bg.jpg'\r\nbg.onload = function () {\r\n    drawImage()\r\n}\r\nlet scale = document.querySelector('#scale'),\r\n    resetButton = document.querySelector('#reset');\r\n    //将图片绘制到canvas画布中\r\nlet drawImage = () => {\r\n        context.clearRect(0, 0, W, H);\r\n        if (scale.checked) {\r\n            context.drawImage(bg, 0, 0, W, H);\r\n        } else {\r\n            context.drawImage(bg, 0, 0)\r\n        }\r\n    },\r\n    \r\n    windowToCanvas = (canvas, x, y) => {\r\n        let canvasRectangle = canvas.getBoundingClientRect()\r\n        return ({\r\n            x: x - canvasRectangle.left,\r\n            y: y - canvasRectangle.top\r\n        })\r\n    },\r\n    //捕捉选取框的像素\r\n    captureRubberbandPixels = () => {\r\n        imageData = context.getImageData(\r\n            selectRec.left,\r\n            selectRec.top,\r\n            selectRec.width,\r\n            selectRec.height\r\n        )\r\n    },\r\n    \r\n    restoreRubberbandPixels = () => {\r\n        context.putImageData(\r\n            imageData,\r\n            selectRec.left,\r\n            selectRec.top\r\n        )\r\n    },\r\n    //绘制选取框\r\n    drawRubberband = () => {\r\n        context.strokeRect(\r\n            selectRec.left + context.lineWidth,\r\n            selectRec.top + context.lineWidth,\r\n            selectRec.width - 2 * context.lineWidth,\r\n            selectRec.height - 2 * context.lineWidth\r\n        )\r\n    },\r\n    updateRubberband = () => {\r\n        captureRubberbandPixels();\r\n        drawRubberband()\r\n    },\r\n    //按下鼠标开始选取\r\n    rubberbandStart = (x, y) => {\r\n        mousedown.x = x;\r\n        mousedown.y = y;\r\n        selectRec.left = mousedown.x;\r\n        selectRec.top = mousedown.y;\r\n        dragging = true\r\n    },\r\n    setRubberbandRectangle = (x, y) => {\r\n        selectRec.left = Math.min(x, mousedown.x)\r\n        selectRec.top = Math.min(y, mousedown.y)\r\n        selectRec.width = Math.abs(x - mousedown.x)\r\n        selectRec.height = Math.abs(y - mousedown.y)\r\n    },\r\n    rubberbandStretch = (x, y) => {\r\n        if (\r\n            selectRec.width > 2 * context.lineWidth &&\r\n            selectRec.height > 2 * context.lineWidth\r\n        ) {\r\n            if (imageData !== null) {\r\n                restoreRubberbandPixels()\r\n            }\r\n        }\r\n        setRubberbandRectangle(x, y);\r\n        if (\r\n            selectRec.width > 2 * context.lineWidth &&\r\n            selectRec.height > 2 * context.lineWidth\r\n        ) {\r\n            updateRubberband()\r\n        }\r\n    },\r\n    rubberbandEnd = () => {\r\n        context.drawImage(\r\n            canvas,\r\n            selectRec.left + context.lineWidth * 2,\r\n            selectRec.top + context.lineWidth * 2,\r\n            selectRec.width - 4 * context.lineWidth,\r\n            selectRec.height - 4 * context.lineWidth,\r\n            0, 0, W, H\r\n        );\r\n        dragging = false;\r\n        imageData = null\r\n    };\r\ncontext.lineWidth = 1;\r\ncontext.strokeStyle = '#fff';\r\n\r\nconsole.log(context.getImageData(0,0,W,H))\r\nconsole.log(context.getImageData(0,0,W,H).width)\r\nconsole.log(context.getImageData(0,0,W,H).height)\r\nconsole.log(context.getImageData(0,0,W,H).data)\r\nconsole.log(context.getImageData(0,0,W,H).data.length)\r\n\r\n\r\ncanvas.addEventListener('mousedown', function (e) {\r\n    let loc = windowToCanvas(canvas, e.clientX, e.clientY);\r\n    e.preventDefault();\r\n    rubberbandStart(loc.x, loc.y);\r\n}, false);\r\ncanvas.addEventListener('mousemove', function (e) {\r\n    let loc;\r\n    if (dragging) {\r\n        loc = windowToCanvas(canvas, e.clientX, e.clientY);\r\n        rubberbandStretch(loc.x, loc.y);\r\n    }\r\n}, false);\r\ncanvas.addEventListener('mouseup', function (e) {\r\n    rubberbandEnd()\r\n}, false)\r\nresetButton.addEventListener('click', function (e) {\r\n    scale.checked = true\r\n    drawImage()\r\n}, false)\r\nscale.addEventListener('change', function () {\r\n    drawImage()\r\n}, false);"]}