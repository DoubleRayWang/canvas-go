{"version":3,"sources":["dog.js"],"names":["DogAnimation","canvas","width","window","innerWidth","onresize","height","lastWalkingTime","Date","now","keyFrameIndex","ctx","getContext","RES_PATH","IMG_COUNT","dog","stepDistance","speed","mouseX","frontStopX","backStopX","loadResources","pictureWidth","dogPictures","naturalWidth","recordMousePosition","requestAnimationFrame","walk","bind","addEventListener","event","clientX","touches","imagesPath","i","push","works","forEach","Promise","img","Image","onload","resolve","src","imgPath","all","then","diffDistance","direct","stopWalking","clearRect","save","scale","drawX","drawImage","naturalHeight","restore","document","querySelector","dogAnimation","start"],"mappings":"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","file":"dog.js","sourcesContent":["!function () {\r\n    class DogAnimation {\r\n        constructor(canvas) {\r\n            this.canvas = canvas;\r\n            canvas.width = window.innerWidth;\r\n            window.onresize = () => canvas.width = window.innerWidth;\r\n            canvas.height = 200;\r\n            // 记录上一帧的时间\r\n            this.lastWalkingTime = Date.now();\r\n            // 当前画的图片索引\r\n            this.keyFrameIndex = -1;\r\n            this.ctx = this.canvas.getContext(\"2d\");\r\n            // 图片目录\r\n            this.RES_PATH = \"img/\";\r\n            this.IMG_COUNT = 8;\r\n            this.dog = {\r\n                // 一步10px\r\n                stepDistance: 9,\r\n                // 狗的速度\r\n                speed: 0.15,\r\n                // 鼠标的x坐标\r\n                mouseX: -1,\r\n                // 往前走停留的位置\r\n                frontStopX: -1,\r\n                // 往回走停留的位置,\r\n                backStopX: window.innerWidth,\r\n            };\r\n        }\r\n        \r\n        async start() {\r\n            await this.loadResources();\r\n            this.pictureWidth = this.dogPictures[0].naturalWidth / 2;\r\n            // 小狗初始化的位置放在最右边\r\n            this.dog.mouseX = window.innerWidth - this.pictureWidth;\r\n            this.recordMousePosition();\r\n            window.requestAnimationFrame(this.walk.bind(this));\r\n        }\r\n        \r\n        // 记录鼠标位置\r\n        recordMousePosition() {\r\n            window.addEventListener(\"mousemove\", event => {\r\n                this.dog.frontStopX = event.clientX - this.pictureWidth;\r\n                this.dog.backStopX = event.clientX;\r\n            });\r\n            window.addEventListener(\"touchstart\", event => {\r\n                this.dog.frontStopX = event.touches[0].clientX - this.pictureWidth;\r\n                this.dog.backStopX = event.touches[0].clientX;\r\n            });\r\n        }\r\n        \r\n        // 加载图片\r\n        loadResources() {\r\n            let imagesPath = [];\r\n            for (let i = 0; i <= this.IMG_COUNT; i++) {\r\n                imagesPath.push(`${this.RES_PATH}${i}.png`);\r\n            }\r\n            let works = [];\r\n            imagesPath.forEach(imgPath => {\r\n                works.push(new Promise(resolve => {\r\n                    let img = new Image();\r\n                    img.onload = () => resolve(img);\r\n                    img.src = imgPath;\r\n                }));\r\n            });\r\n            return new Promise(resolve => {\r\n                Promise.all(works).then(dogPictures => {\r\n                    this.dogPictures = dogPictures;\r\n                    resolve();\r\n                });\r\n            });\r\n        }\r\n        \r\n        walk() {\r\n            let now = Date.now();\r\n            let diffDistance = (now - this.lastWalkingTime) * this.dog.speed;\r\n            if (diffDistance < this.dog.stepDistance) {\r\n                window.requestAnimationFrame(this.walk.bind(this));\r\n                return;\r\n            }\r\n            this.keyFrameIndex = ++this.keyFrameIndex % this.IMG_COUNT;\r\n            let direct = -1,\r\n                stopWalking = false;\r\n            // 如果鼠标在狗的前面则往前走\r\n            if (this.dog.frontStopX > this.dog.mouseX) {\r\n                direct = 1;\r\n            }\r\n            // 如果鼠标在狗的后面则往回走\r\n            else if (this.dog.backStopX < this.dog.mouseX) {\r\n                direct = -1;\r\n            }\r\n            // 如果鼠标在狗在位置\r\n            else {\r\n                stopWalking = true;\r\n                // 初始化的时候小狗是反方向的，frontStopX为初始值-1\r\n                // 说明鼠标还没动过\r\n                direct = this.dog.frontStopX === -1 ? -1 :\r\n                    this.dog.backStopX - this.dog.mouseX\r\n                    > this.pictureWidth / 2 ? 1 : -1;\r\n                this.keyFrameIndex = -1;\r\n                //this.dog.mouseX = this.dog.stopX;\r\n            }\r\n            let ctx = this.ctx;\r\n            ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n            \r\n            ctx.save();\r\n            if (!stopWalking) {\r\n                this.dog.mouseX += this.dog.stepDistance * direct;\r\n            }\r\n            if (direct === -1) {\r\n                ctx.scale(direct, 1);\r\n            }\r\n            let img = this.dogPictures[this.keyFrameIndex + 1];\r\n            let drawX = 0;\r\n            drawX = this.dog.mouseX * direct -\r\n                (direct === -1 ? this.pictureWidth : 0);\r\n            ctx.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight,\r\n                drawX, 20, 186, 162);\r\n            ctx.restore();\r\n            this.lastWalkingTime = now;\r\n            window.requestAnimationFrame(this.walk.bind(this));\r\n        }\r\n    }\r\n    \r\n    let canvas = document.querySelector(\"#dog\");\r\n    let dogAnimation = new DogAnimation(canvas);\r\n    dogAnimation.start();\r\n}();\r\n"]}